# 服务器同步功能使用指南

## 功能概述

服务器同步功能允许在多个Discord服务器之间同步身份组和处罚记录，实现跨服务器的统一管理。

## 主要功能

### 1. 身份组同步
- 在配置的服务器之间自动同步指定的身份组
- 支持管理员手动触发用户身份组同步
- 当管理员添加/移除身份组时自动同步到其他服务器

### 2. 处罚同步
- 将禁言、封禁等处罚同步到其他服务器
- 目标服务器管理员需要确认执行处罚
- 自动同步处罚撤销操作

## 配置步骤

### 1. 启用同步功能

在 `config/server_sync/config.json` 中设置：
```json
{
  "enabled": true
}
```

### 2. 添加服务器到同步网络

在每个要参与同步的服务器中，使用管理员权限执行：
```
/同步管理 添加服务器
```

### 3. 配置身份组映射

为需要同步的身份组建立映射关系：
```
/同步管理 身份组 名字:VIP role:@VIP身份组
```

### 4. 配置处罚同步（可选）

#### 4.1 启用处罚同步
```
/同步管理 处罚同步 状态:开
```

#### 4.2 设置处罚公示频道
```
/同步管理 处罚公示频道 频道:#公示频道
```

#### 4.3 设置处罚确认频道
```
/同步管理 处罚确认频道 频道:#管理频道
```

## 使用方法

### 用户身份组同步

用户可以主动同步自己的身份组到其他服务器：
```
/同步 身份组同步
```

### 管理员操作

所有管理员的身份组操作和处罚操作都会自动触发同步：
- `/管理 身份组` - 自动同步身份组添加/移除
- `/管理 禁言` - 自动同步禁言处罚
- `/管理 永封` - 自动同步封禁处罚
- `/管理 撤销处罚` - 自动同步处罚撤销

## 配置文件结构

### config/server_sync/config.json
```json
{
  "enabled": true,
  "servers": {
    "服务器ID1": {
      "name": "服务器名称",
      "roles": {
        "VIP": 角色ID,
        "管理员": 角色ID
      },
      "punishment_sync": true,
      "punishment_announce_channel": 频道ID,
      "punishment_confirm_channel": 频道ID
    }
  },
  "role_mapping": {
    "VIP": {
      "服务器ID1": 角色ID1,
      "服务器ID2": 角色ID2
    }
  },
  "punishment_sync": {
    "enabled": true,
    "servers": {
      "服务器ID1": true,
      "服务器ID2": true
    }
  }
}
```

## 权限要求

- 机器人需要在所有参与同步的服务器中具有以下权限：
  - 管理身份组（Manage Roles）
  - 禁言成员（Timeout Members）
  - 封禁成员（Ban Members）
  - 发送消息（Send Messages）
  - 嵌入链接（Embed Links）

## 注意事项

1. **权限检查**：机器人只能操作权限位置低于自己的身份组
2. **处罚确认**：跨服务器处罚需要目标服务器管理员确认
3. **身份组映射**：不同服务器的相同身份组需要建立明确的映射关系
4. **网络延迟**：同步操作可能有短暂延迟
5. **错误处理**：如果某个服务器离线或权限不足，同步会跳过该服务器

## 故障排除

### 同步失败的常见原因
1. 机器人权限不足
2. 目标服务器中不存在对应的身份组
3. 用户不在目标服务器中
4. 身份组权限位置高于机器人

### 查看日志
检查机器人日志以获取详细的错误信息和同步状态。 